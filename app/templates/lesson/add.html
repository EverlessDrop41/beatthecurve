{% set join_lesson=True %}
{% extends 'li_layout.html' %}
{% from 'macros.html' import render_field %}
{% block title %}Add Lessons{% endblock %}
{% block content %}
  <ul class="collection with-header">
    {% for l in get_lessons(current_user) %}
      {% if loop.first %}<li class="collection-header"><h4>Joined Classes</h4></li>{% endif %}
      <li class="collection-item"><a href="{{ url_for("notes_bp.view", lessonid=l.id) }}">{{ l.lesson_name }}</a></li>
    {% endfor %}
  </ul>

  <h3>Join a new class</h3>
  <form method="post">
    {% for field in form %}
      {{ render_field(field) }}
    {% endfor %}
    <div class="row">
      <!-- <span class="col s1">&nbsp;</span> -->
      <button type="submit" class="col s12 waves-effect waves-light btn-large">Add</button>
      <!-- <span class="col s1">&nbsp;</span> -->
    </div>
  </form>
{% endblock %}
{% block js %}
{{super()}}
<script>
  $(document).ready(function () {
    for (var i = 0; i < $("#lessons").siblings().length; i++) {
      var item = $("#lessons").siblings()[i]; 
      $(item).hide();
    }
    $("label").hide();
    lessons_select = $("#lessons");
    $("option[value='-1']").attr("disabled", "");
    lessons_select.show();
    lessons_select.multiSelect({
      selectableHeader: "<div class='select-header'>Available Classes</div> <input type='text' autocomplete='off' id='selectableSearch' placeholder='Search for a lesson'>",
      selectionHeader: "<div class='selection-header'>Classes to join</div> <input type='text' autocomplete='off' id='selectionSearch' placeholder='Search for a lesson'>",
      afterInit: function(ms){
      var that = this,
          // $selectableSearch = that.$selectableUl.prev(),
          // $selectionSearch = that.$selectionUl.prev(),
           selectableSearchString = '#'+that.$container.attr('id')+' .ms-elem-selectable:not(.ms-selected)',
           selectionSearchString = '#'+that.$container.attr('id')+' .ms-elem-selection.ms-selected';

          selectableSearch = $("#selectableSearch");
          selectionSearch = $("#selectionSearch");
          //selectableSearchString 


        that.qs1 = selectableSearch.quicksearch(selectableSearchString)
        .on('keydown', function(e){
          if (e.which === 40){
            //that.$selectableUl.focus();
            return false;
          }
        });

        that.qs2 = selectionSearch.quicksearch(selectionSearchString)
        .on('keydown', function(e){
          if (e.which == 40){
            //that.$selectionUl.focus();
            return false;
          }
        });
      },
      afterSelect: function(){
        this.qs1.cache();
        this.qs2.cache();
      },
      afterDeselect: function(){
        this.qs1.cache();
        this.qs2.cache();
      }
    });
    // lessons_select.attr("size",lessons_select.children().size());
  });
</script>
{% endblock %}
