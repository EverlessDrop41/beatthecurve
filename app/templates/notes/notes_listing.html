{% extends 'class_layout.html' %}
{% from 'macros.html' import render_lesson_tabs, render_semester_tabs, render_field %}
{% block title %}{{ lesson.lesson_name }}{% endblock %}
{% block page %}
  {{ render_lesson_tabs('notes', lesson.id) }}
  {% if semesters|length > 0 %}
    {{ render_semester_tabs(semesters, semester_enum) }}
  {% endif %}
  <ul>
      {% for message in get_flashed_messages() %}
        <li>{{ message }}</li>
      {% endfor %}
  </ul>

  <div class="row">
    <a class="waves-effect waves-light btn modal-trigger col s12 bg-primary" href="#newNoteModal">Uplaod a note</a>
  </div>
  <div id="newNoteModal" class="modal">
    <div class="modal-content">
      <form method="post" enctype="multipart/form-data" id="add-note-form" action="{{ url_for("notes_bp.add_note", lessonid=lesson.id) }}">

         {% for field in form %}
           {{ render_field(field) }}
         {% endfor %}
         <div class="row">
           <div class="col s2">&nbsp;</div>
           <button type="submit" class="waves-effect waves-light btn-large col s8">Upload</button>
           <div class="col s2">&nbsp;</div>
         </div>
       </form>
    </div>
    <div class="modal-footer">
      <a href="#!" class=" modal-action modal-close waves-effect btn-flat">Cancel</a>
    </div>
  </div>
  {% if semesters|length < 0 %}
    <h5 class="no-content-message">No Lectures</h5>
  {% endif %}
  <!-- <a href="{{ url_for("notes_bp.add_note", lessonid=lesson.id) }}" class="btn">Upload Note</a> -->
  <table>
    {% for note in notes %}
      <tr  semester="{{ note.semester }}" year="{{ note.year }}">
        <ul class="horizontal-ul">
          <li>{{ note.filename }}</li>
          <li>Votes: {{ note.votes }}</li>
          {% if note.has_voted(current_user) %}
            {% if note.has_upvoted(current_user) %}
              <li>
                <i class="material-icons">thumb_up</i>
              </li>
              <li>
                <a href="{{ url_for("notes_bp.vote", noteid=note.id, upvote="0") }}"><i class="material-icons">thumb_down</i></a>
              </li>
            {% elif note.has_voted(current_user) %}
              <li>
                <a href="{{ url_for("notes_bp.vote", noteid=note.id, upvote="1") }}"><i class="material-icons">thumb_up</i></a>
              </li>
              <li>
                <i class="material-icons">thumb_down</i>
              </li>
            {% endif %}
          {% else %}
            <li><a href="{{ url_for("notes_bp.vote", noteid=note.id, upvote="1") }}"><i class="material-icons">thumb_up</i></a></li>
            <li><a href="{{ url_for("notes_bp.vote", noteid=note.id, upvote="0") }}"><i class="material-icons">thumb_down</i></a></li>
          {% endif %}
          <li><a href="https://s3-us-west-2.amazonaws.com/beatthecurve/notes/{{ note.filename }}">Download</a></li>
        </ul>
      </tr>
    {% endfor %}
  </table>
{% endblock %}
{% block js %}
{{super()}}
  <script>
      $(document).ready(function() {
          var active = $('.semester-tab > a.active')[0].parentElement;
          var year = $(active).attr('year');
          var semester = $(active).attr('semester');
          $('tr').hide();
          $('tr[year="' + year + '"][semester="' + semester + '"]').show();
          $('.semester-tab').click(
            function (e) {
              var year = $(this).attr('year');
              var semester = $(this).attr('semester');
              $('tr').hide();
              $('tr[year="' + year + '"][semester="' + semester + '"]').show();
            }
          );
      });
  </script>
    <script src="{{ static_url }}js/upload_note.js"></script>
<script type="text/javascript">
$(document).ready(function(){
  // the "href" attribute of .modal-trigger must specify the modal ID that wants to be triggered
  $('.modal-trigger').leanModal();
})
</script>
{% endblock %}
