{% extends 'layout.html' %}
{% from 'macros.html' import render_lesson_tabs, render_semester_tabs, render_field %}
{% block title %}{{ lesson.lesson_name }}{% endblock %}
{% block main %}
  {{ render_lesson_tabs('exams', lesson.id) }}
  {% if semesters|length > 0 %}
    {{ render_semester_tabs(semesters, semester_enum) }}
  {% else %}
    <h5>No Exams</h5>
  {% endif %}
  <ul>
      {% for message in get_flashed_messages() %}
        <li>{{ message }}</li>
      {% endfor %}
  </ul>
  <form method="post" enctype="multipart/form-data" id="add-exam-form" action="{{ url_for("exams_bp.add_exam") }}">
    {% for field in form %}
      {{ render_field(field) }}
    {% endfor %}
    <button type="button" class="waves-effect waves-light btn-large" id="submit">Add Exam</button>
  </form>
  <ul>
      {% for message in get_flashed_messages() %}
        <li>{{ message }}</li>
      {% endfor %}
    </ul>
  <div class="section">
    <table id="exams-table">
      <thead>
        <tr>
          <th>Exam</th>
          <th>Year</th>
          <th>Number Of Takers</th>
          <th>Average Grade</th>
        </tr>
      </thead>
      <tbody>
        {% for exam in exams %}
          <tr semester="{{ exam.semester }}" year="{{ exam.year }}">
          <td>
            <a href="{{ url_for("exams_bp.detail", examid=exam.id) }}" class="file">{{ exam.filename }}</a>
          </td>
          <td>
            {{ exam.year }}
          </td>
          <td>{{ exam.number_of_takers }}</td>
          <td>{{ exam.average_grade }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}
{% block js %}
  <script>
      $(document).ready(function() {
        if ($("#exams-table tbody tr").length === 0) {
          $("#exams-table").hide()
        } else {
          var active = $('.semester-tab > a.active')[0].parentElement;
          var year = $(active).attr('year');
          var semester = $(active).attr('semester');
          $('tr').hide();
          $('tr[year="' + year + '"][semester="' + semester + '"]').show();
          $('.semester-tab').click(
            function (e) {
              var year = $(this).attr('year');
              var semester = $(this).attr('semester');
              $('tr').hide();
              $('tr[year="' + year + '"][semester="' + semester + '"]').show();
            }
          );
        }

      });
  </script>
  <script src="{{ static_url }}js/upload_exam.js"></script>
{% endblock %}
