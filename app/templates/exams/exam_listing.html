{% set active = 'exams' %}
{% extends 'class_layout.html' %}
{% from 'macros.html' import render_lesson_tabs, render_semester_tabs, render_field %}
{% block title %}{{ lesson.lesson_name }}{% endblock %}
{% block page %}
  <div class="col s2">
    {% if semesters|length > 0 %}
      {{ render_semester_tabs(semesters, semester_enum) }}
    {% else %}
      <h5>No Exams Available</h5>
    {% endif %}
  </div>
  <div class="col s10">
    <div class="row">
      <a class="waves-effect waves-light btn modal-trigger col s12 bg-primary" href="#newExamModal">Upload an exam</a>
    </div>
    <div class="modal" id="newExamModal">
      <div class="modal-content">
        <div class="container">
          <h3 class="center">Upload an Exam</h3>
          <form method="post" enctype="multipart/form-data" id="add-exam-form" action="{{ url_for("exams_bp.add_exam", lessonid=lesson.id) }}">
            {% for field in form %}
              {{ render_field(field) }}
            {% endfor %}
            <!-- <button type="button" class="waves-effect waves-light btn-large" id="submit">Add Exam</button> -->
            <div class="row">
              <div class="col s2">&nbsp;</div>
              <button type="submit" class="waves-effect waves-light btn-large col s8">Upload</button>
              <div class="col s2">&nbsp;</div>
            </div>
          </form>
        </div>
      </div>
      <div class="modal-footer">
        <a href="#!" class=" modal-action modal-close waves-effect btn-flat">Cancel</a>
      </div>
    </div>
    <ul>
        {% for message in get_flashed_messages() %}
          <li>{{ message }}</li>
        {% endfor %}
      </ul>
    <div class="section">
      <table id="exams-table">
        <thead>
          <tr>
            <th>Exam</th>
            <th>Year</th>
            <th>Number Of Takers</th>
            <th>Average Grade</th>
          </tr>
        </thead>
        <tbody>
          {% for exam in exams %}
            <tr semester="{{ exam.semester }}" year="{{ exam.year }}">
            <td>
              <a href="{{ url_for("exams_bp.detail", examid=exam.id) }}" class="file">{{ exam.filename }}</a>
            </td>
            <td>
              {{ exam.year }}
            </td>
            <td>{{ exam.number_of_takers }}</td>
            <td>{{ exam.average_grade }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}
{% block js %}
{{super()}}
  <script>
      // $(document).ready(function() {
      //   if ($("#exams-table tbody tr").length === 0) {
      //     $("#exams-table").hide()
      //   } else {
      //     var active = $('.semester-tab > a.active')[0].parentElement;
      //     var year = $(active).attr('year');
      //     var semester = $(active).attr('semester');
      //     $('tr').hide();
      //     $('tr[year="' + year + '"][semester="' + semester + '"]').show();
      //     $('.semester-tab').click(
      //       function (e) {
      //         var year = $(this).attr('year');
      //         var semester = $(this).attr('semester');
      //         $('tr').hide();
      //         $('tr[year="' + year + '"][semester="' + semester + '"]').show();
      //       }
      //     );
      //   }
      //
      // });
  </script>
  <script src="{{ static_url }}js/upload_exam.js"></script>
  <script type="text/javascript">
  $(document).ready(function(){
    // the "href" attribute of .modal-trigger must specify the modal ID that wants to be triggered
    $('.modal-trigger').leanModal();
  })
  </script>
{% endblock %}
